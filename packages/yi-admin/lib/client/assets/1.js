(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{100:function(t,e,n){(e=n(21)(!1)).push([t.i,".table-view{font-size:12px;margin:0 1.5em}.table-view>.top-action{padding:.8em 0 .5em}.table-view>.top-action>.top-action-row{font-size:.9em;color:rgba(0,0,0,.667);padding:.5em 0}.table-view>.top-action>.top-action-row>.refresh-btn{border-style:dashed}.table-view>.top-action>.top-action-row>.action-lable,.table-view>.top-action>.top-action-row>.el-select{margin:0 .8em 0 0}.table-view>.top-action>.top-action-row>.el-select.dashed>.el-input>input{border-style:dashed}.table-view>.top-action>.top-action-row>.batch-action-helptext{font-size:12px;margin:0 .3em;padding:0 .3em}.table-view>.panel-box{box-shadow:0 0 3px rgba(0,0,0,.067)}.table-view>.panel-box>.table-wrapper{overflow-x:auto}.table-view>.panel-box>.table-wrapper>table{min-width:100%;background:#fff;border-collapse:collapse;font-size:12px}.table-view>.panel-box>.table-wrapper>table>thead{border-bottom:2px dotted rgba(0,0,0,.267);line-height:1.2;color:rgba(0,0,0,.667)}.table-view>.panel-box>.table-wrapper>table>thead>tr>th{padding:1.2em .4em 1em}.table-view>.panel-box>.table-wrapper>table>tbody{line-height:1.5}.table-view>.panel-box>.table-wrapper>table>tbody>tr>td{padding:.8em;font-size:12px;color:rgba(0,0,0,.667);border-right:1px dotted rgba(0,0,0,.133)}.table-view>.panel-box>.table-wrapper>table>tbody>tr>td:last-child{border-right:none}.table-view>.panel-box>.table-wrapper>table>tbody>tr>td.actions-td,.table-view>.panel-box>.table-wrapper>table>tbody>tr>td.index-td{text-align:center}.table-view>.panel-box>.table-wrapper>table>tbody>tr>td.actions-td .el-button{padding:.4em .8em;margin:.3em}.table-view>.panel-box>.table-wrapper>table>tbody>tr>td>.fields-wrap{text-align:center}.table-view>.panel-box>.table-wrapper>table>tbody>tr:nth-child(2n - 1){background:rgba(0,0,0,.039)}.table-view>.panel-box>.table-wrapper>.no-data{text-align:center;line-height:4;color:rgba(0,0,0,.533);font-size:1.3em}.table-view>.panel-box>.table-view-footer{border-top:1px dashed rgba(0,0,0,.2);line-height:3em;background:#fff;padding:.7em 1em .2em;color:rgba(0,0,0,.667)}",""]),t.exports=e},101:function(t,e,n){"use strict";var a=n(64);n.n(a).a},102:function(t,e,n){(e=n(21)(!1)).push([t.i,"body{background:#f6f6f6}#app{padding:0 0 2em;transition:opacity .3s}#app>pre{font-size:12px}",""]),t.exports=e},172:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("no-ssr",{staticClass:"breadcrumb"},[e("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[e("el-breadcrumb-item",{attrs:{to:{path:"../../"}}},[e("a",{attrs:{href:"../../",target:"_top"}},[this._v("首页")])]),e("el-breadcrumb-item",[this._v(this._s(this.state.modelInfo.title||this.state.modelInfo.name)+" 管理")])],1)],1),e("TableView")],1)};a._withStripped=!0;var i=n(0),r=n.n(i),s=n(3),o=n.n(s),c=n(10),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("no-ssr",{directives:[{name:"loading",rawName:"v-loading",value:t.state.loading,expression:"state.loading"}],staticClass:"table-view"},[n("div",{staticClass:"top-action"},[n("TableSort",{staticClass:"top-action-row"}),n("div",{staticClass:"top-action-row"},[n("el-button",{staticClass:"create-btn",attrs:{size:"mini",icon:"el-icon-plus"},on:{click:t.createData}},[t._v("\n            新增\n         ")]),n("el-button",{staticClass:"refresh-btn",attrs:{size:"mini",icon:"el-icon-refresh-right"},on:{click:t.reloadData}},[t._v("\n            刷新\n         ")])],1),n("div",{staticClass:"top-action-row"},[n("span",{staticClass:"action-lable"},[t._v("对选中项进行")]),n("el-select",{class:0===t.checkedIdList.length?"dashed":"",attrs:{placeholder:"请选择操作",size:"mini"},model:{value:t.batchActionIndex,callback:function(e){t.batchActionIndex=e},expression:"batchActionIndex"}},t._l(t.batchActionOptions,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),[t.selectedBatchAction&&t.selectedBatchAction.popConfirm?n("el-popconfirm",{attrs:{title:"确定执行吗？"},on:{onConfirm:function(e){return t.doBatchAction(t.selectedBatchAction)}}},[n("el-button",{attrs:{slot:"reference",size:"mini",type:t.selectedBatchAction.buttonType||"",icon:t.selectedBatchAction.buttonIcon||""},slot:"reference"},[t._v("\n                  执行\n               ")])],1):n("el-button",{attrs:{size:"mini",type:t.selectedBatchAction&&t.selectedBatchAction.buttonType||"",icon:t.selectedBatchAction&&t.selectedBatchAction.buttonIcon||"",disabled:null==t.selectedBatchAction},on:{click:function(e){return t.doBatchAction(t.selectedBatchAction)}}},[t._v("\n               执行\n            ")])],t.checkedIdList?n("span",{staticClass:"batch-action-helptext"},[t._v("\n            "+t._s(0===t.checkedIdList.length?"当前未勾选任何项目":"已选中"+t.checkedIdList.length+"条记录")+"\n         ")]):t._e()],2)],1),n("div",{staticClass:"panel-box"},[n("div",{staticClass:"table-wrapper"},[n("table",{staticClass:"table-view-table"},[n("thead",{staticClass:"table-view-thead"},[n("tr",[n("th",{staticClass:"checkbox-all"},[n("el-checkbox",{attrs:{value:t.allChecked},on:{change:t.handelCheckAll}})],1),n("th",[t._v("#")]),n("th",[t._v("id")]),n("th",[t._v("操作")]),t._l(t.listFields,(function(e,a){return n("th",{key:a},[n("span",{domProps:{textContent:t._s(e.fieldNameAlias||e.fieldName)}})])}))],2)]),n("tbody",{staticClass:"table-view-tbody"},t._l(t.listData,(function(e,a){return n("tr",{key:e.id||a},[n("td",[n("el-checkbox",{model:{value:t.listCheckedStatusArray[a],callback:function(e){t.$set(t.listCheckedStatusArray,a,e)},expression:"listCheckedStatusArray[index]"}})],1),n("td",{staticClass:"index-td"},[t._v("\n                     "+t._s(a+1)+"\n                  ")]),n("td",[n("a",{attrs:{href:"edit/?id="+e.id}},[t._v(t._s(e.id))])]),n("td",{staticClass:"actions-td"},[t._l(t.rowListActions,(function(a,i){return[a.popConfirm?n("el-popconfirm",{key:i,attrs:{title:"确定执行吗？"},on:{onConfirm:function(n){return t.doActions(a,[e.id])}}},[n("el-button",{attrs:{slot:"reference",size:"mini",type:a.buttonType||"",icon:a.buttonIcon||""},slot:"reference"},[t._v("\n                              "+t._s(a.actionName)+"\n                           ")])],1):n("el-button",{key:i,attrs:{size:"mini",type:a.buttonType||"",icon:a.buttonIcon||""},on:{click:function(n){return t.doActions(a,[e.id])}}},[t._v("\n                           "+t._s(a.actionName)+"\n                        ")])]}))],2),t._l(t.listFields,(function(a,i){return n("td",{key:i},[n("div",{staticClass:"fields-wrap"},[n(t.getComponent(a.componentName),{tag:"component",attrs:{id:e.id,config:a.componentConfig,"field-name":a.fieldName,values:e.values,"object-key":a.fieldName,value:e.values[a.fieldName]}})],1)])}))],2)})),0)]),0===t.listData.length?n("div",{staticClass:"no-data"},[t._v("\n            暂时没有数据呦~\n         ")]):t._e()]),n("div",{staticClass:"table-view-footer"},[n("el-pagination",{attrs:{"current-page":t.pageIndex,background:"","page-sizes":[10,20,50,100,200],"page-size":t.state.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.state.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)])])};l._withStripped=!0;var u=n(96),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"table-sort-block"},[n("span",{staticClass:"action-lable"},[t._v("排序:")]),t._l(t.sortList,(function(e,a){return n("div",{key:a,staticClass:"sort-item"},[n("el-select",{attrs:{placeholder:"请选择",size:"mini"},on:{change:t.handleChange},model:{value:t.sortList[a],callback:function(e){t.$set(t.sortList,a,e)},expression:"sortList[idx]"}},t._l(t.getOptions(a),(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}},[n("span",[t._v(t._s(e.label))])])})),1),n("div",{staticClass:"sort-item-info"},[n("button",{staticClass:"text-button danger",on:{click:function(e){return t.removeRule(a)}}},[t._v("\n            删除\n         ")]),n("span",[t._v("该排序")])])],1)})),n("button",{staticClass:"text-button",on:{click:t.createNewRule}},[t._v("\n      增加\n   ")]),n("span",[t._v("排序规则")])],2)};d._withStripped=!0;var p=n(54),f=n.n(p),h={computed:{state:function(){return this.$store.state},listFields:function(){return this.state.listFields||[]},sortList:function(){return this.state.sortList},sortOptions:function(){var t=[];t.push({label:"+ id 增序",value:"_id"},{label:"- id 降序",value:"-_id"});for(var e=0;e<this.listFields.length;e+=1){var n=this.listFields[e],a=n.fieldNameAlias||n.fieldName;t.push({label:"".concat(a," 增序(+)"),value:"".concat(n.fieldName)},{label:"".concat(a," 降序(-)"),value:"-".concat(n.fieldName)})}return t}},methods:{getOptions:function(t){for(var e=this.sortOptions,n=[],a=f()(this.sortList).slice(0,t),i=0;i<e.length;i+=2){var r=e[i],s=e[i+1];a.includes(r.value)||a.includes(s.value)||n.push(r,s)}return n},createNewRule:function(){this.sortList.push("")},removeRule:function(t){this.sortList.splice(t,1)},clearRules:function(){for(var t=this.sortList,e=[],n=[],a=0;a<t.length;a+=1){var i=t[a],r=i.replace(/^-/,"");n.includes(r)||(e.push(i),n.push(r))}this.state.sortList=e},handleChange:function(){this.clearRules()}}},b=(n(97),n(9)),v=Object(b.a)(h,d,[],!1,null,null,null);v.options.__file="src/client/pages/model-admin-list/table-sort.vue";var m={components:{TableSort:v.exports},data:function(){return{pageIdx:0,batchActionIndex:null}},computed:{state:function(){return this.$store.state},pageIndex:function(){return this.state.pageIndex},listFields:function(){return this.state.listFields},listActions:function(){return this.state.listActions},listData:function(){return this.state.listData},listCheckedStatusArray:function(){return this.state.listCheckedStatusArray},checkedIdList:function(){for(var t=[],e=this.listData,n=this.listCheckedStatusArray,a=0;a<e.length;a+=1){var i=e[a];!0===n[a]&&t.push(i.id)}return t},betListActions:function(){return this.listActions.filter((function(t){return t.isBatchAction}))},batchActionOptions:function(){for(var t=[],e=this.betListActions,n=0;n<e.length;n+=1){var a=e[n];t.push({value:n,label:a.actionName})}return t},selectedBatchAction:function(){return"number"==typeof this.batchActionIndex?this.betListActions[this.batchActionIndex]:null},rowListActions:function(){return this.listActions.filter((function(t){return t.isTableRowAction}))},allChecked:function(){for(var t=!0,e=0;e<this.listCheckedStatusArray.length;e+=1)if(!this.listCheckedStatusArray[e]){t=!1;break}return t}},watch:{"state.sortList":function(){var t=this;this.$nextTick((function(){t.reloadData()}))}},methods:{getComponent:function(t){return Object.prototype.hasOwnProperty.call(u.default,t)?u.default[t]:u.default.base},handelCheckAll:function(){var t=!0;this.allChecked&&(t=!1);for(var e=0;e<this.listCheckedStatusArray.length;e+=1)this.$set(this.listCheckedStatusArray,e,t)},handleSizeChange:function(t){var e=this;return o()(r.a.mark((function n(){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.$store.commit("setPageIndex",1),e.$store.commit("setPageSize",t),n.prev=2,n.next=5,e.$store.dispatch("fetchListData");case 5:n.next=10;break;case 7:n.prev=7,n.t0=n.catch(2),e.$notify.error({title:"出错了",message:(null===n.t0||void 0===n.t0?void 0:n.t0.message)||"拉取数据出错了"});case 10:case"end":return n.stop()}}),n,null,[[2,7]])})))()},handleCurrentChange:function(t){var e=this,n=this.state.pageIndex;this.$store.commit("setPageIndex",0),this.$nextTick(o()(r.a.mark((function a(){return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.$store.commit("setPageIndex",n),a.prev=1,a.next=4,e.$store.dispatch("fetchListData",{pageIndex:t});case 4:a.next=9;break;case 6:a.prev=6,a.t0=a.catch(1),e.$notify.error({title:"出错了",message:(null===a.t0||void 0===a.t0?void 0:a.t0.message)||"拉取数据出错了"});case 9:case"end":return a.stop()}}),a,null,[[1,6]])}))))},createData:function(){return o()(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:window.location="edit/";case 1:case"end":return t.stop()}}),t)})))()},reloadData:function(){var t=this;return o()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$store.dispatch("fetchListData");case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),t.$notify.error({title:"出错了",message:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||"拉取数据出错了"});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))()},doBatchAction:function(t){var e=this;return o()(r.a.mark((function n(){var a;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((a=e.checkedIdList).length<=0)){n.next=4;break}return e.$notify.error({title:"未勾选任何项目"}),n.abrupt("return");case 4:e.doActions(t,a);case 5:case"end":return n.stop()}}),n)})))()},doActions:function(t){var e=arguments,n=this;return o()(r.a.mark((function a(){var i,s,o,c,l,u,d,p;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=e.length>1&&void 0!==e[1]?e[1]:[],!n.state.loading){a.next=3;break}return a.abrupt("return");case 3:if(!n.state.loading){a.next=5;break}return a.abrupt("return");case 5:return n.$store.commit("setLoading",!0),a.prev=6,a.next=9,n.$ajax.post("list/action/",{actionName:t.actionName,idList:i});case 9:if(s=a.sent,!(o=s.data).success){a.next=16;break}c=o.data||{},l=c.successfulNum,u=void 0===l?0:l,d=c.failedNum,p=void 0===d?0:d,n.$notify.success({title:"".concat(t.actionName," 执行完成"),message:"".concat(u," 项执行成功，").concat(p," 项执行失败")}),a.next=17;break;case 16:throw new Error((null==o?void 0:o.message)||"执行 ".concat(t.actionName," 操作失败了"));case 17:a.next=22;break;case 19:a.prev=19,a.t0=a.catch(6),n.$notify.error({title:"".concat(t.actionName," 未执行完成"),message:(null===a.t0||void 0===a.t0?void 0:a.t0.message)||"执行 ".concat(t.actionName," 操作失败了")});case 22:return a.prev=22,n.$store.commit("setLoading",!1),a.finish(22);case 25:return a.prev=25,a.next=28,n.$store.dispatch("fetchListData");case 28:a.next=33;break;case 30:a.prev=30,a.t1=a.catch(25),n.$notify.error({title:"出错了",message:(null===a.t1||void 0===a.t1?void 0:a.t1.message)||"拉取数据出错了"});case 33:case"end":return a.stop()}}),a,null,[[6,19,22,25],[25,30]])})))()}}},g=(n(99),Object(b.a)(m,l,[],!1,null,null,null));g.options.__file="src/client/pages/model-admin-list/table-view.vue";var x={components:{TableView:g.exports},createStore:function(t){var e=t.ajax.get;return new c.a.Store({state:{modelInfo:{},loading:!1,pageIndex:1,pageSize:10,total:0,sortList:["-_id"],listFields:[],listActions:[],listData:[],listCheckedStatusArray:[]},mutations:{setLoading:function(t,e){t.loading=!!e},setListFields:function(t,e){var n=e.data;t.listFields=n.fields,t.modelInfo=n.modelInfo},setListActions:function(t,e){var n=e.data,a=[],i={};(n||[]).forEach((function(t){Object.prototype.hasOwnProperty.call(i,t.actionName)||(a.push(t),i[t.actionName]=!0)})),t.listActions=a},setListData:function(t,e){var n=e.dataList,a=e.total;t.total=a,t.listData=n;var i=new Array(n.length);i.fill(!1),t.listCheckedStatusArray=i},setPageSize:function(t,e){t.pageSize=e},setPageIndex:function(t,e){t.pageIndex=e}},actions:{fetchListFields:function(){var t=this;return o()(r.a.mark((function n(){var a,i;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e("list/fields/",{});case 2:if(a=n.sent,!(i=a.data).success){n.next=8;break}t.commit("setListFields",i),n.next=9;break;case 8:throw new Error((null==i?void 0:i.message)||"拉取字段信息出错了");case 9:case"end":return n.stop()}}),n)})))()},fetchListActions:function(){var t=this;return o()(r.a.mark((function n(){var a,i;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e("list/actions/",{});case 2:if(a=n.sent,!(i=a.data).success){n.next=8;break}t.commit("setListActions",i),n.next=9;break;case 8:throw new Error((null==i?void 0:i.message)||"拉取操作信息出错了");case 9:case"end":return n.stop()}}),n)})))()},fetchListData:function(t){var n=arguments,a=this;return o()(r.a.mark((function i(){var s,o,c,l,u,d;return r.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=t.state,o=n.length>1&&void 0!==n[1]?n[1]:{},c=o.pageIndex,l=void 0===c?s.pageIndex:c,!s.loading){i.next=4;break}return i.abrupt("return");case 4:return a.commit("setLoading",!0),i.prev=5,i.next=8,e("list/data/",{pageIndex:l,pageSize:s.pageSize,sort:s.sortList.join(" ")});case 8:if(u=i.sent,!(d=u.data).success){i.next=15;break}a.commit("setListData",d.data),a.commit("setPageIndex",l),i.next=16;break;case 15:throw new Error((null==d?void 0:d.message)||"拉取列表数据出错了");case 16:return i.prev=16,a.commit("setLoading",!1),i.finish(16);case 19:case"end":return i.stop()}}),i,null,[[5,,16,19]])})))()}}})},fetchData:function(t){return o()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.store.dispatch("fetchListFields"),t.store.dispatch("fetchListActions"),t.store.dispatch("fetchListData")]);case 2:case"end":return e.stop()}}),e)})))()},data:function(){return{}},computed:{state:function(){return this.$store.state}},mounted:function(){}},w=(n(101),Object(b.a)(x,a,[],!1,null,null,null));w.options.__file="src/client/pages/model-admin-list/app.vue";e.default=w.exports},52:function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}},54:function(t,e,n){var a=n(55),i=n(56),r=n(57),s=n(58);t.exports=function(t){return a(t)||i(t)||r(t)||s()}},55:function(t,e,n){var a=n(52);t.exports=function(t){if(Array.isArray(t))return a(t)}},56:function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},57:function(t,e,n){var a=n(52);t.exports=function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}},58:function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},62:function(t,e,n){var a=n(98);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n(22).default)("99f6adf2",a,!1,{sourceMap:!1})},63:function(t,e,n){var a=n(100);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n(22).default)("7d88a4a7",a,!1,{sourceMap:!1})},64:function(t,e,n){var a=n(102);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n(22).default)("ff766086",a,!1,{sourceMap:!1})},96:function(t,e,n){"use strict";n.r(e);var a={array:function(){return n.e(19).then(n.bind(null,166))},base:function(){return n.e(20).then(n.bind(null,164))},boolean:function(){return n.e(21).then(n.bind(null,162))},"string-enum":function(){return n.e(22).then(n.bind(null,171))},"string-remote-select":function(){return n.e(24).then(n.bind(null,157))},"string-image":function(){return n.e(23).then(n.bind(null,154))},"string-textarea":function(){return n.e(25).then(n.bind(null,152))}};e.default=a},97:function(t,e,n){"use strict";var a=n(62);n.n(a).a},98:function(t,e,n){(e=n(21)(!1)).push([t.i,".table-sort-block>.action-lable{line-height:2.5em}.table-sort-block>.sort-item{display:inline-block;vertical-align:top;margin:0 .5em 0 .2em}.table-sort-block>.sort-item>.sort-item-info{line-height:2;padding:0 1em}.table-sort-block button.text-button{border:none;background:none;font-size:1em;color:#409eff;cursor:pointer}.table-sort-block button.text-button.danger{color:#f56c6c}",""]),t.exports=e},99:function(t,e,n){"use strict";var a=n(63);n.n(a).a}}]);