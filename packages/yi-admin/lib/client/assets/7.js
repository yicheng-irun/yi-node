(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{797:function(e,t,n){"use strict";function a(e){var t=Number.parseFloat(e);return Number.isNaN(t)?"NaN":t>1e9?"".concat((t/1e9).toFixed(2),"Mb"):t>1e6?"".concat((t/1e6).toFixed(2),"Mb"):t>1e3?"".concat((t/1e3).toFixed(2),"Kb"):"".concat(t,"b")}n.d(t,"a",(function(){return a}))},798:function(e,t,n){var a=n(854);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n(10).default)("7a276b0e",a,!1,{sourceMap:!1})},853:function(e,t,n){"use strict";var a=n(798);n.n(a).a},854:function(e,t,n){(t=n(9)(!1)).push([e.i,".form-component-string-file>.file-link{margin:0 .5em 0 0;font-size:12px}.form-component-string-file>.a-button{padding:.2em .5em;margin:0 .3em}",""]),e.exports=t},903:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"form-component-string-file"},[e.value?n("a",{staticClass:"file-link",attrs:{href:e.value,target:"_blank"}},[e._v(e._s(e.value))]):e._e(),n("a-button-group",[e.value?n("a-button",{attrs:{type:"danger",icon:"close",size:"small"},on:{click:function(t){return e.handleInput("")}}}):e._e(),n("a-button",{attrs:{size:"small",type:"primary"},on:{click:e.selectFile}},[e._v("\n         "+e._s(e.value?"重新选择":"选择文件")+"\n      ")])],1)],1)};a._withStripped=!0;var r=n(40),i=n.n(r),o=n(65),c=n.n(o),u=n(797),l={model:{prop:"value",event:"input"},props:{fieldName:{type:String,default:""},value:{type:String,default:""},config:{type:Object,default:function(){return{maxFileSize:1e4,mimeType:"*"}}}},data:function(){return{}},mounted:function(){var e=this,t=document.createElement("input");this.fileInput=t,t.type="file",t.accept=this.config.mimeType||"*",t.onchange=function(){var n=t.files[0];e.doUploadAction(n)}},methods:{selectFile:function(){var e=this;return c()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.fileInput.click();case 1:case"end":return t.stop()}}),t)})))()},upload:function(e){var t=this;return c()(i.a.mark((function n(){var a,r,o,c,u;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(c=new FormData).append("name",e.name),c.append("file",e),console.log(c.get("file")),n.next=6,t.$ajax.post("component-action/",c,{fieldName:t.fieldName,actionName:"upload"},{headers:{"Content-Type":"multipart/form-data"}});case 6:if(!(null==(u=n.sent)||null===(a=u.data)||void 0===a?void 0:a.success)||!(null===(r=u.data.data)||void 0===r?void 0:r.url)){n.next=9;break}return n.abrupt("return",u.data.data.url);case 9:throw new Error((null==u||null===(o=u.data)||void 0===o?void 0:o.message)||"上传文件失败");case 10:case"end":return n.stop()}}),n)})))()},doUploadAction:function(e){var t=this;return c()(i.a.mark((function n(){var a;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,console.log(e,t.config),!(e.size>t.config.maxFileSize)){n.next=4;break}throw new Error("您选择的文件大小超过了最大".concat(Object(u.a)(t.config.maxFileSize),"限制"));case 4:return n.next=6,t.upload(e);case 6:a=n.sent,t.handleInput(a),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),t.$message.error((null===n.t0||void 0===n.t0?void 0:n.t0.message)||String(n.t0)||"选取文件失败了");case 13:case"end":return n.stop()}}),n,null,[[0,10]])})))()},handleInput:function(e){var t=String(e);this.$emit("input",t)}}},s=(n(853),n(138)),p=Object(s.a)(l,a,[],!1,null,null,null);p.options.__file="src/client/pages/model-admin-edit/form-components/string-file.vue";t.default=p.exports}}]);